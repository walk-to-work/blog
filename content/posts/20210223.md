+++
title = "Vroid用衣装をCygnetちゃんに着せた"
tags = ["VRChat","Unity","Blender"]
date = "2021-02-23"
+++

# Vroid用衣装をCygnetちゃんに着せた（自分用メモ）

## TL;DR

くそ好みな衣装のVroid用テクスチャをBoothで発見したのでfbxにして（ついでにボーンも入れて）Cygnetちゃんに着せた．フレンドがやり方を簡単に教えてほしいと言っていたのでその過程を記す．

## はじめに

Boothを見ているとバチクソ好みの服があった．ガチで良い．

[砂鳥れん - 【無料】チャイナロゴスリーブシャツ【VRoid】](https://renfactory.booth.pm/items/1921172)

しかし，Vroid用衣装である．Cygnetちゃん等のモデルに着せてVRChatで使用するには一度fbx形式にしてからUnityに取り込む必要がある．その過程を記す．
(これを書いた時点でセシル変身の存在を知らなかった，使ったらもっと楽になるかも，要検証)

## 環境

- Vroid Studio                  0.12.1
- Blender                       2.91.2(2.83の方がいいかも)
    - Cats Blender Plugin (0.18.0)
    - VRM Add-on for Blender
- Unity                         2018.4.21f

Cats...及びVRM Add...はあらかじめBlenderに導入済みで，今回は日本語化されていることを前提に書いています．
参考:[[Blender] アドオンのインストール・アップデート・アンインストール方法のまとめ](https://qiita.com/nutti/items/5e9ebe9c28751066b688)

## Vroid StudioからVRMを書き出す

プリセット衣装を選択>テクスチャを読み込み>衣装のパラメータを調整

![パラメータ調整](/images/20210223/1.png)

[エクスポート]メニューを選択後，[撮影・エクスポート]>[ポリゴンの削減]>[透明メッシュを削除する]にチェック．これをやっておかないと手間が増える．

![透明メッシュの削除にチェック](/images/20210223/2.png)

Vroid終わり

## Blenderでモデルの編集

Blenderを起動．メニューバーの[ファイル]>[インポート]>[VRM(.vrm)]して，ファイルを選択しインポート（Blender 2.93ではここでよく落ちる，2.83の方がいいかも）．

![VRM読み込み](/images/20210223/3.png)

右上の『<』みたいなやつ（下図参照）のやつを引っ張りだして[CATS]を選択

![1](/images/20210223/4_1.png)

[モデル修正]をクリック（2.91では，たまに落ちる2.83の方がいいかも）．レンダリングされたVroid Studioで見たのと同じモデルが出ます．

![1](/images/20210223/4.png)

[オブジェクトモード]にして，服や顔等（ボーン以外ならなんでもいい）を選択，そのまま[編集モード]に移動すると下図のように点だらけになる．この状態でキーボードの"p"を押すとメッシュの分割ができる．[マテリアルで]を選択する．

![1](/images/20210223/5.png)

右上のアウトライナーで下図のようなオレンジの下三角を探す．服以外のメッシュを選択，右クリック>[削除]．

![1](/images/20210223/6.png)

こんな感じになるはず．線しか表示されていないときは，モデル（？）が表示されているところでキーボードの"z">[レンダー]．それでも表示されない場合はどこかで間違えてるかも．

![1](/images/20210223/7.png)

透明部分はメッシュが削られているが，途中からテクスチャが切れて半分透明といったメッシュは削除されていない．これを手動で削っていく（そのうち自動化したいね）．

[1](/images/20210223/8.png)

まずは首から（撮ったスクショの都合で）

![1](/images/20210223/11.png)

[オブジェクトモード]>メッシュ選択>[編集モード]でキーボードの"k"を押し，ナイフモード？を出す．その状態でメッシュ上を左クリックすると赤い四角が打たれ，さらに違う箇所を押すとその四角と四角を結ぶ切れ込みができる．それで透明部分とテクスチャがある部分の境界を繋いで首回りを一周回す．スタート地点に戻ってきたらキーボード"Enter"で点が透明部分を分かつ線ができる．

![1](/images/20210223/12.png)

左上の方のボタンで面選択モード（下図参照）にして，

![1](/images/20210223/13_1.png)

透明部分の面を選択，キーボード"x"で削除．

![1](/images/20210223/13.png)

裾も同様にする．

![1](/images/20210223/9.png)
![1](/images/20210223/10.png)

----
ここからは自分用メモ．オタクが好きな裾の長さなのでついでにボーンを入れてヒラヒラさせる．線で区切られている部分まで飛ばしてよい．

[オブジェクトモード]>Armature選択>[編集モード]>Hip選択>キーボード"e">キーボード"z"で角度固定>キーボード"g"で移動&角度調整でボーンをいれる×8，アウトライナーで名前を変更>入れたボーンを全部選択>Hip選択>キーボード"Ctrl+p">[オフセットを維持]

![1](/images/20210223/15.png)

[Object Mode]>Armature選択>[Pose Mode]>裾のボーンをshift押しながら全部選択

[Object Mode]>shift押しながらArmature，meshの順に選択>左上で[ウェイトペイント]に移動

[ウェイト]＞[自動割り当て]

![1](/images/20210223/17.png)

自分用メモ終わり

---

メニューバーで[ファイル]>[エクスポート]>[FBX(.fbx)]．

![](/images/20210223/14.png)

[トランスフォーム]>[すべてFBX]にチェック（した方がいいらしい）

![](/images/20210223/18.png)

## Unityでアバターを着せ替え

fbxファイルをUnityに取り込む．ドラッグ&ドロップでもなんでもいい．

マテリアルを作るなり，既存のものをコピーするなどしてVroid用のテクスチャを割り当てる．

メッシュにマテリアルを割り当てる．

![Unity画面](/images/20210223/19.png)

後は次の火事屋様等を参考にして，着せる．着せ替えのプラグイン等を使ってもいいかなぁと思っているが，まだ導入していない．

[VRChatアバター改変：非専用お洋服の着せ替え方法](https://note.com/kaziya21/n/n3a2a0948931c)

終わり．